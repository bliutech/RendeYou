<!--
  Temporary frontend to test backend endpoints.
-->

<!DOCTYPE html>
<html>

<head>

</head>

<body>
  <form id="register">
    <p>/register</p>
    <p><label>username: <input></label></p>
    <p><label>password: <input type="password"></label></p>
    <input type="submit">
  </form>

  <form id="get-user">
    <p>/user/[id]</p>
    <p><label>id: <input></label></p>
    <input type="submit">
  </form>

  <form id="search-users">
    <p>/user</p>
    <p><label>ids: <input id="search-ids"></label></p>
    <p><label>username: <input id="search-username"></label></p>
    <p><label>first: <input id="search-first"></label></p>
    <p><label>last: <input id="search-last"></label></p>
    <input type="submit">
  </form>

  <form id="current-user">
    <p>/user/me</p>
    <p>username: <span id="current-username"></span></p>
    <p><label>firstName: <input id="update-first"></label></p>
    <p><label>lastName: <input id="update-last"></label></p>
    <p><label>email: <input id="update-email"></label></p>
    <input type="submit">
  </form>
  <input type="button" id="get-current-user" value="Get Current User">
  <input type="button" id="delete-current-user" value="Delete Current User">

  <form id="login">
    <p>/login</p>
    <p><label>username: <input></label></p>
    <p><label>password: <input type="password"></label></p>
    <input type = "submit">
  </form>
  
  <form id="logout">
    <p>/logout</p>
    <input type = "submit">
  </form> 

  <input type="button" id="check-session" value="Check Session">

  <script>
    function backend(endpoint) {
      return "http://localhost:8000" + endpoint;
    }

    function toQuery(obj) {
      return new URLSearchParams(obj).toString();
    }

    function $(id) {
      return document.getElementById(id);
    }

    const registerForm = $("register");
    registerForm.addEventListener("submit", function (e) {
      e.preventDefault();
      const data = {
        username: registerForm.querySelector("input").value,
        password: registerForm.querySelector("input[type=password]").value
      }
      fetch(backend("/register"), {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(data)
      });
    });

    const getUserForm = $("get-user");
    getUserForm.addEventListener("submit", function (e) {
      e.preventDefault();
      const id = getUserForm.querySelector("input").value;
      fetch(backend("/user/" + id));
    });

    const searchUsersForm = $("search-users");
    searchUsersForm.addEventListener("submit", function (e) {
      e.preventDefault();
      const data = {
        ids: $("search-ids").value,
        username: $("search-username").value,
        first: $("search-first").value,
        last: $("search-last").value
      };
      fetch(backend("/user?" + toQuery(data)));
    });

    const currentUserForm = $("current-user");
    currentUserForm.addEventListener("submit", function (e) {
      e.preventDefault();
      const data = {
        firstName: $("update-first").value,
        lastName: $("update-last").value,
        email: $("update-email").value
      };
      fetch(backend("/user/me"), {
        method: "PUT",
        credentials: "include",
        body: JSON.stringify(data)
      });
    });

    const getLoggedUser = document.getElementById("login");
    getLoggedUser.addEventListener("submit", function(e) {
      e.preventDefault();
      const data = {
        username: getLoggedUser.querySelector("input").value,
        password: getLoggedUser.querySelector("input[type=password]").value
      }
      fetch(backend("/login"), {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(data)
      });
    });

    const getCurrentUserButton = $("get-current-user");
    getCurrentUserButton.addEventListener("click", async function (e) {
      const res = await fetch(backend("/user/me"), { credentials: "include" });
      const json = await res.json();
      $("current-username").textContent = json.username;
      $("update-first").value = json.firstName;
      $("update-last").value = json.lastName;
      $("update-email").value = json.email;
    });

    const deleteCurrentUserButton = $("delete-current-user");
    deleteCurrentUserButton.addEventListener("click", function (e) {
      fetch(backend("/user/me"), { method: "DELETE", credentials: "include" });
    });
    
    const Logout = document.getElementById("logout");
    Logout.addEventListener("submit", function(e) {
      e.preventDefault();
      fetch(backend("/logout"), {
        method: "POST"
      });
    });

    const checkSessionButton = $("check-session");
    checkSessionButton.addEventListener("click", function(e) {
      fetch(backend("/check-session"));
    });
  </script>
</body>

</html>
